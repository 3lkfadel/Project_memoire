{% extends "layout.html" %}
{% set active_tab = 'peers' %}

{% block content %}
  <div class="panel-head">
    <div class="actions">
      {% if running %}
        <a class="btn primary" href="{{ url_for('peers_new') }}">+ Ajouter un peer</a>
      {% else %}
        <span class="hint">Démarrez wg0 pour gérer les peers.</span>
      {% endif %}
    </div>
  </div>

  <h2 class="h2">Peers</h2>
  {% if running and peers %}
  <div class="table">
    <div class="row head">
      <div>Clé publique</div><div>Endpoint</div><div>Allowed IPs</div>
      <div>Handshake</div><div>RX</div><div>TX</div><div>Keepalive</div><div>Actions</div>
    </div>
    {% for p in peers %}
    <div class="row">
      <div class="mono keycell" title="{{ p.public_key }}">{{ p.public_key[:12] }}…{{ p.public_key[-8:] }}</div>
      <div>{{ p.endpoint or '—' }}</div>
      <div class="mono">{{ p.allowed_ips }}</div>
      <div>{{ p.latest_handshake }}</div>
      <div>{{ p.transfer_rx }}</div>
      <div>{{ p.transfer_tx }}</div>
      <div>{{ p.keepalive or '—' }}</div>
      <div class="row-actions">
        <a class="btn ghost" href="{{ url_for('peers_edit_form') }}?public_key={{ p.public_key }}">Modifier</a>
        <form method="post" action="{{ url_for('peers_delete') }}" onsubmit="return confirm('Supprimer ce peer ?');">
          <input type="hidden" name="public_key" value="{{ p.public_key }}">
          <button class="btn danger" type="submit">Supprimer</button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <p class="hint">Aucun peer (ou interface arrêtée).</p>
  {% endif %}
{% endblock %}
